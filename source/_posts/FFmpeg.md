---
title: FFmpeg学习笔记
date: 2020-01-18 12:42:43
tags: 工具
---

最近研究了如何使用IDM下载B站的视频，然后发现B站会将原文件做一个音视频分离，所以下载下来会包含两个文件，且后缀都是 `.mp4` 。因此搜索并学习了如何使用FFmpeg处理音视频等文件。

<!-- more -->

## 前言

[FFmpeg](https://www.ffmpeg.org/download.html#get-packages) 是一款开源命令行工具，在视频处理领域应用广泛，支持多种格式。

视频文件本质上是一种多媒体容器，包含有图像、音频、字幕等内容。一个视频文件的后缀反映了这个文件的**容器格式**。

比如常见的 `.mp4` 后缀，全称 `MPEG-4 Part 14` ，表示一种标准的数位多媒体容器格式。仅有音频的 `MPEG-4` 文件会使用 `.m4a` 扩展名，这在使用IDM下载网易云的音乐时很常见。

扩展名为 `.flv` 或 `.f4v` 的Flash视频格式与MPEG-4第14部分极为相似，多数情况下直接变更扩展名为`.mp4`也能够正常播放。

而另一种常见的后缀 `.mkv` ，全称 `Matroska` ，是一种多媒体封装格式，可以把多种不同编码的影像及16条或以上不同格式的音频和语言不同的字幕封装到一个文件内（一个很有趣的冷知识是， `Matroska` 的俄语 `матроска` 是 `матрёшка`（俄罗斯套娃）的误读，因为Matroska的工作原理就跟层层套叠的俄罗斯娃娃一样，是“愈包愈紧”的，故得名）。

存储于多媒体容器中的图像和音频都需要经过一定的编码，不同的编码格式（coder-decoder，简称codec）有不同的压缩率，会导致文件大小和清晰度的差异，且不同的容器格式支持的编码格式也不尽相同。为了编码和解码具有某种编码格式的文件，需要安装对应的编码器（encoder）。

FFmpeg已经内置了很多编码器，使用 `ffmpeg -encoders` 可以查看其已安装的编码器。

## 使用方法

使用前需通过上面的链接下载FFmpeg的编译发行版，并将所在文件夹添加到环境变量。

总体上来看，FFmpeg的命令行使用格式可以理解为，接受一个或一些输入，并给出一个输出。输入文件以 `-i` 开头表示是输入，其后可以跟输入文件的参数。文件的参数中，使用 `-c` 指定编码器。除直接指定编码器外，还可以使用 `-c copy` 表示使用和源文件一样的编码器。使用 `-c:v` 和 `-c:a` 可单独指定视频或音频的编码器。此外，使用 `-an` 或 `-vn` 去除视频文件的音频或视频流。

举一些例子来说，如果要从一个视频文件中提取音频，则可以使用

```
ffmpeg -i input.mp4 -vn -c:a copy output.aac
```

而向一个仅有视频流的视频文件添加音频，则可以这样写：

```
ffmpeg -i input.aac -i input.mp4 output.mp4
```

## 升阶用法

调整编码的比特率（以下命令设定码率为964K~3856K，缓冲区大小2000K）

```
ffmpeg -i input.mp4 -minrate 964K -maxrate 3856K -bufsize 2000K output.mp4
```

调整分辨率

```
ffmpeg -i input.mp4 -vf scale=480:-1 output.mp4
```

截取原视频中的片段

```
ffmpeg -ss [start] -i input.mp4 -t [duration] -c copy output.mp4
ffmpeg -ss [start] -i input.mp4 -to [end] -c copy output.mp4
```

